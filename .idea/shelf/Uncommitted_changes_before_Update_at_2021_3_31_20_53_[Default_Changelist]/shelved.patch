Index: src/index.ts
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import { render, TemplateResult } from 'lit-html'\nimport { effect, shallowReactive } from '@vue/reactivity'\nimport { PropType, PropsType, PropTypes, validateProp } from './props'\nimport { isFunction, toBoolean } from './utils'\nimport set = Reflect.set;\n\ntype HookFn = () => unknown\ntype HookName = '_bm' | '_bu' | '_u' | '_m' | '_um'\ntype Hooks = Array<HookFn>\n\nlet currentInstance: any | null\n\ntype GetPropType<T> = T extends ObjectConstructor ? Record<string, any> : T extends BooleanConstructor ? boolean : T extends NumberConstructor ? number : T extends StringConstructor ? string : T extends ArrayConstructor ? Array<any> : T extends FunctionConstructor ? Function : PropType<T>\n\ninterface SetupFn<Props extends PropsType = {}>{\n  (props: {\n    [key in keyof Props]: Props[key]['type'] extends PropType ? Props[key]['type'] :Props[key]['type'] extends Array<PropTypes> ? GetPropType<Props[key]['type'][0]> : GetPropType<Props[key]['type']>\n  }, context: HTMLElement & {\n    $el: ShadowRoot\n    $refs: Record<string, HTMLElement | HTMLElement[]>\n    emit(event: string, payload?: any): void\n  }): () => TemplateResult\n}\nexport function defineComponent<Name extends Lowercase<string>>(name: Name, setup: SetupFn, mode?: ShadowRootMode): void\nexport function defineComponent<Name extends Lowercase<string>, Props extends PropsType = {}>(name: Name, props: Props, setup: SetupFn<Props>, mode?: ShadowRootMode): void\n\nexport function defineComponent<Name extends Lowercase<string>, Props extends PropsType = {}>(name: Name, props: Props | SetupFn<Props>, setup?: SetupFn<Props> | ShadowRootMode, mode?: ShadowRootMode) {\n  let propsKeys: string[] = []\n  let setupFn: SetupFn<Props>\n  let propsConfig: PropsType = {}\n  let modeConfig: ShadowRootMode = 'closed'\n  if (isFunction(props)) {\n    setupFn = props\n    if (typeof setup === 'string') {\n      modeConfig = setup\n    }\n  } else if (isFunction(setup)) {\n    setupFn = setup\n    propsConfig = props\n    propsKeys = Object.keys(props)\n    if (mode) {\n      modeConfig = mode\n    }\n  }\n\n  const Component = class extends HTMLElement {\n    private readonly _props: any\n    private readonly _bm: Hooks = []\n    private readonly _bu: Hooks = []\n    private readonly _u: Hooks = []\n    private readonly _m: Hooks = []\n    private readonly _um: Hooks = []\n    public readonly $el: ShadowRoot\n    public $refs: Record<string, HTMLElement | HTMLElement[]> = {}\n\n    static get observedAttributes() {\n      return propsKeys\n    }\n    constructor() {\n      super()\n      const propsInit = this._getProps()\n      // run validate prop\n      Object.keys(propsInit).forEach(key => validateProp(key, propsConfig[key], propsInit))\n      const props = (this._props = shallowReactive(propsInit))\n      currentInstance = this\n      const template = setupFn.call(null, props, this)\n      currentInstance = null\n      this._bm && this._bm.forEach((cb) => cb())\n      this.emit('hook:beforeMount')\n      this.$el = this.attachShadow({ mode: modeConfig })\n      let isMounted = false\n      effect(() => {\n        if (!isMounted) {\n          this._bu && this._bu.forEach((cb) => cb())\n          this.emit('hook:beforeUpdate')\n        }\n        render(template(), this.$el)\n        if (isMounted) {\n          this._applyDirective()\n          this._u && this._u.forEach((cb) => cb())\n          this.emit('hook:updated')\n        } else {\n          isMounted = true\n        }\n      })\n      // Remove an instance properties that alias reactive properties which\n      // might have been set before the element was upgraded.\n      for (const propName of propsKeys) {\n        if (this.hasOwnProperty(propName)) {\n          const v = (this as any)[propName];\n          delete (this as any)[propName];\n          (this as any)[propName] = v;\n        }\n      }\n    }\n\n    public emit(event: string, payload?: any) {\n      const customEvent = new CustomEvent(event, {\n        bubbles: true,\n        detail: payload,\n      });\n      this.dispatchEvent(customEvent)\n    }\n\n    private _applyDirective() {\n      this._applyVShow()\n      this._applyRef()\n    }\n\n    private _applyRef() {\n      const refs = this.$el.querySelectorAll<HTMLElement>('[ref]')\n      this.$refs = {}\n      Array.from(refs).forEach((el) => {\n        const refKey = el.getAttribute('ref') as string\n        if (this.$refs[refKey]) {\n          if (Array.isArray(this.$refs[refKey])) {\n            ;(this.$refs[refKey] as HTMLElement[]).push(el)\n          } else {\n            this.$refs[refKey] = [(this.$refs[refKey] as HTMLElement), el]\n          }\n        } else {\n          this.$refs[refKey] = el\n        }\n      })\n    }\n\n    private _applyVShow() {\n      const vShows = this.$el.querySelectorAll<HTMLElement& { __prevShow: boolean, __prevDisplay: string }>('[v-show]')\n      Array.from(vShows).forEach((el) => {\n        const show = toBoolean(el.getAttribute('v-show'))\n        if (el.__prevShow !== show) {\n          if (show) {\n            el.style.display = el.__prevDisplay\n          } else {\n            el.__prevDisplay = el.style.display || ''\n            el.style.display = 'none'\n          }\n          el.__prevShow = show\n        }\n      })\n    }\n\n    private _getProps() {\n      // 用.传入的props 在getAttribute拿不到，需要从this.propName上进行取\n      let obj: any = {}\n      for (const propName of propsKeys) {\n        obj[propName] = this.getAttribute(propName) || (this as any)[propName] || undefined\n      }\n      return obj\n    }\n\n    connectedCallback() {\n      this._applyDirective()\n      this._m && this._m.forEach((cb) => cb())\n      this.emit('hook:mounted')\n    }\n    disconnectedCallback() {\n      this._um && this._um.forEach((cb) => cb())\n      this.emit('hook:unmount')\n    }\n    attributeChangedCallback(name: string, oldValue: any, newValue: any) {\n      this._props[name] = newValue\n      validateProp(name, propsConfig[name], this._props)\n    }\n  }\n  for (const propName of propsKeys) {\n    Object.defineProperty(Component.prototype, propName, {\n      get() {\n        if (!this._props) return undefined;\n        return this._props[propName];\n      },\n      set(v) {\n        this._props[propName] = v;\n        validateProp(propName, propsConfig[propName], this._props)\n      }\n    });\n  }\n\n  customElements.define(\n    name,\n    Component\n  )\n}\n\nfunction createLifecycleMethod(name: HookName) {\n  return (cb: HookFn) => {\n    if (currentInstance) {\n      ;(currentInstance[name] || (currentInstance[name] = [])).push(cb)\n    }\n  }\n}\n\nexport const onBeforeMount = createLifecycleMethod('_bm')\nexport const onMounted = createLifecycleMethod('_m')\nexport const onBeforeUpdate = createLifecycleMethod('_bu')\nexport const onUpdated = createLifecycleMethod('_u')\nexport const onUnmounted = createLifecycleMethod('_um')\n\nexport * from 'lit-html'\nexport * from '@vue/reactivity'\nexport * from './watch'\nexport type {\n  PropType\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/index.ts b/src/index.ts
--- a/src/index.ts	(revision 329f20523cf2d0a6fc2b1fa17f049684a9d71c01)
+++ b/src/index.ts	(date 1617195169963)
@@ -28,7 +28,7 @@
   let propsKeys: string[] = []
   let setupFn: SetupFn<Props>
   let propsConfig: PropsType = {}
-  let modeConfig: ShadowRootMode = 'closed'
+  let modeConfig: ShadowRootMode = 'open'
   if (isFunction(props)) {
     setupFn = props
     if (typeof setup === 'string') {
@@ -201,4 +201,4 @@
 export * from './watch'
 export type {
   PropType
-}
\ No newline at end of file
+}
Index: .idea/workspace.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"BranchesTreeState\">\r\n    <expand>\r\n      <path>\r\n        <item name=\"ROOT\" type=\"e8cecc67:BranchNodeDescriptor\" />\r\n        <item name=\"LOCAL_ROOT\" type=\"e8cecc67:BranchNodeDescriptor\" />\r\n      </path>\r\n      <path>\r\n        <item name=\"ROOT\" type=\"e8cecc67:BranchNodeDescriptor\" />\r\n        <item name=\"REMOTE_ROOT\" type=\"e8cecc67:BranchNodeDescriptor\" />\r\n      </path>\r\n      <path>\r\n        <item name=\"ROOT\" type=\"e8cecc67:BranchNodeDescriptor\" />\r\n        <item name=\"REMOTE_ROOT\" type=\"e8cecc67:BranchNodeDescriptor\" />\r\n        <item name=\"GROUP_NODE:origin\" type=\"e8cecc67:BranchNodeDescriptor\" />\r\n      </path>\r\n    </expand>\r\n    <select />\r\n  </component>\r\n  <component name=\"ChangeListManager\">\r\n    <list default=\"true\" id=\"c121206b-fad7-46c8-ae58-5bea3e221d08\" name=\"Default Changelist\" comment=\"\">\r\n      <change beforePath=\"$PROJECT_DIR$/package.json\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/package.json\" afterDir=\"false\" />\r\n    </list>\r\n    <option name=\"SHOW_DIALOG\" value=\"false\" />\r\n    <option name=\"HIGHLIGHT_CONFLICTS\" value=\"true\" />\r\n    <option name=\"HIGHLIGHT_NON_ACTIVE_CHANGELIST\" value=\"false\" />\r\n    <option name=\"LAST_RESOLUTION\" value=\"IGNORE\" />\r\n  </component>\r\n  <component name=\"Git.Settings\">\r\n    <option name=\"RECENT_GIT_ROOT_PATH\" value=\"$PROJECT_DIR$\" />\r\n    <option name=\"RESET_MODE\" value=\"MIXED\" />\r\n  </component>\r\n  <component name=\"GitSEFilterConfiguration\">\r\n    <file-type-list>\r\n      <filtered-out-file-type name=\"LOCAL_BRANCH\" />\r\n      <filtered-out-file-type name=\"REMOTE_BRANCH\" />\r\n      <filtered-out-file-type name=\"TAG\" />\r\n      <filtered-out-file-type name=\"COMMIT_BY_MESSAGE\" />\r\n    </file-type-list>\r\n  </component>\r\n  <component name=\"GitToolBoxStore\">\r\n    <option name=\"projectConfigVersion\" value=\"2\" />\r\n  </component>\r\n  <component name=\"ProjectId\" id=\"1meSdTQzklz82xdnNo7y3xQpDbq\" />\r\n  <component name=\"ProjectViewState\">\r\n    <option name=\"hideEmptyMiddlePackages\" value=\"true\" />\r\n    <option name=\"showLibraryContents\" value=\"true\" />\r\n  </component>\r\n  <component name=\"PropertiesComponent\">\r\n    <property name=\"RunOnceActivity.OpenProjectViewOnStart\" value=\"true\" />\r\n    <property name=\"RunOnceActivity.ShowReadmeOnStart\" value=\"true\" />\r\n    <property name=\"WebServerToolWindowFactoryState\" value=\"false\" />\r\n    <property name=\"last_opened_file_path\" value=\"$PROJECT_DIR$\" />\r\n    <property name=\"node.js.detected.package.eslint\" value=\"true\" />\r\n    <property name=\"node.js.detected.package.tslint\" value=\"true\" />\r\n    <property name=\"node.js.path.for.package.eslint\" value=\"project\" />\r\n    <property name=\"node.js.path.for.package.tslint\" value=\"project\" />\r\n    <property name=\"node.js.selected.package.eslint\" value=\"(autodetect)\" />\r\n    <property name=\"node.js.selected.package.tslint\" value=\"(autodetect)\" />\r\n    <property name=\"nodejs_package_manager_path\" value=\"yarn\" />\r\n    <property name=\"settings.editor.selected.configurable\" value=\"settings.javascript.prettier\" />\r\n    <property name=\"ts.external.directory.path\" value=\"C:\\Users\\22938\\Desktop\\ego\\ok-lit\\node_modules\\typescript\\lib\" />\r\n    <property name=\"vue.rearranger.settings.migration\" value=\"true\" />\r\n  </component>\r\n  <component name=\"SpellCheckerSettings\" RuntimeDictionaries=\"0\" Folders=\"0\" CustomDictionaries=\"0\" DefaultDictionary=\"application-level\" UseSingleDictionary=\"true\" transferred=\"true\" />\r\n  <component name=\"TaskManager\">\r\n    <task active=\"true\" id=\"Default\" summary=\"Default task\">\r\n      <changelist id=\"c121206b-fad7-46c8-ae58-5bea3e221d08\" name=\"Default Changelist\" comment=\"\" />\r\n      <created>1609852652313</created>\r\n      <option name=\"number\" value=\"Default\" />\r\n      <option name=\"presentableId\" value=\"Default\" />\r\n      <updated>1609852652313</updated>\r\n      <workItem from=\"1609852654871\" duration=\"1515000\" />\r\n      <workItem from=\"1609854186931\" duration=\"24000\" />\r\n      <workItem from=\"1609854524781\" duration=\"11000\" />\r\n      <workItem from=\"1609855843147\" duration=\"640000\" />\r\n      <workItem from=\"1609898232765\" duration=\"207000\" />\r\n      <workItem from=\"1609898456971\" duration=\"22742000\" />\r\n      <workItem from=\"1609984422638\" duration=\"11906000\" />\r\n      <workItem from=\"1610010792522\" duration=\"2897000\" />\r\n      <workItem from=\"1610073688774\" duration=\"5395000\" />\r\n      <workItem from=\"1610158720216\" duration=\"4651000\" />\r\n      <workItem from=\"1610359414677\" duration=\"1135000\" />\r\n      <workItem from=\"1610435956846\" duration=\"1453000\" />\r\n      <workItem from=\"1610534605352\" duration=\"1117000\" />\r\n      <workItem from=\"1611022437066\" duration=\"16000\" />\r\n      <workItem from=\"1611047236787\" duration=\"615000\" />\r\n      <workItem from=\"1611647728640\" duration=\"697000\" />\r\n      <workItem from=\"1611744409813\" duration=\"2173000\" />\r\n      <workItem from=\"1611817248405\" duration=\"170000\" />\r\n      <workItem from=\"1611822759538\" duration=\"3470000\" />\r\n      <workItem from=\"1611829336832\" duration=\"487000\" />\r\n      <workItem from=\"1611916704748\" duration=\"136000\" />\r\n      <workItem from=\"1614051115765\" duration=\"643000\" />\r\n      <workItem from=\"1615803056577\" duration=\"485000\" />\r\n    </task>\r\n    <task id=\"LOCAL-00001\" summary=\"feat: 编写Readme\">\r\n      <created>1610359773997</created>\r\n      <option name=\"number\" value=\"00001\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00001\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1610359773997</updated>\r\n    </task>\r\n    <option name=\"localTasksCounter\" value=\"2\" />\r\n    <servers />\r\n  </component>\r\n  <component name=\"TypeScriptGeneratedFilesManager\">\r\n    <option name=\"version\" value=\"3\" />\r\n  </component>\r\n  <component name=\"Vcs.Log.Tabs.Properties\">\r\n    <option name=\"TAB_STATES\">\r\n      <map>\r\n        <entry key=\"MAIN\">\r\n          <value>\r\n            <State>\r\n              <option name=\"FILTERS\">\r\n                <map>\r\n                  <entry key=\"branch\">\r\n                    <value>\r\n                      <list>\r\n                        <option value=\"master\" />\r\n                      </list>\r\n                    </value>\r\n                  </entry>\r\n                </map>\r\n              </option>\r\n            </State>\r\n          </value>\r\n        </entry>\r\n      </map>\r\n    </option>\r\n    <option name=\"oldMeFiltersMigrated\" value=\"true\" />\r\n  </component>\r\n  <component name=\"VcsManagerConfiguration\">\r\n    <MESSAGE value=\"feat: 编写Readme\" />\r\n    <option name=\"LAST_COMMIT_MESSAGE\" value=\"feat: 编写Readme\" />\r\n  </component>\r\n  <component name=\"XSLT-Support.FileAssociations.UIState\">\r\n    <expand />\r\n    <select />\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/workspace.xml b/.idea/workspace.xml
--- a/.idea/workspace.xml	(revision 329f20523cf2d0a6fc2b1fa17f049684a9d71c01)
+++ b/.idea/workspace.xml	(date 1617195170196)
@@ -20,7 +20,8 @@
   </component>
   <component name="ChangeListManager">
     <list default="true" id="c121206b-fad7-46c8-ae58-5bea3e221d08" name="Default Changelist" comment="">
-      <change beforePath="$PROJECT_DIR$/package.json" beforeDir="false" afterPath="$PROJECT_DIR$/package.json" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/.idea/workspace.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/workspace.xml" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/src/index.ts" beforeDir="false" afterPath="$PROJECT_DIR$/src/index.ts" afterDir="false" />
     </list>
     <option name="SHOW_DIALOG" value="false" />
     <option name="HIGHLIGHT_CONFLICTS" value="true" />
@@ -94,6 +95,7 @@
       <workItem from="1611916704748" duration="136000" />
       <workItem from="1614051115765" duration="643000" />
       <workItem from="1615803056577" duration="485000" />
+      <workItem from="1617195151675" duration="19000" />
     </task>
     <task id="LOCAL-00001" summary="feat: 编写Readme">
       <created>1610359773997</created>
